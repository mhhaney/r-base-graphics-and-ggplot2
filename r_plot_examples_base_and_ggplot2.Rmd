---
title: "R Plots Implemented with Base R and ggplot2"
author: "DSA400W Class at Chatham University, Fall 2021"
date: "9/21/2021"
output: html_document
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Overview

This document will explore the implementation of various types of plots that can be produced with base R graphics and/or the ggplot2 package. For each plot type we begin by showing basic plots and then enhance the plots by combining plot types, adding new variables using faceting, color, shape or size, or customizing colors, axes, axis labels, annotations or styles.

## Histogram

## Density Curve

### Basic Density Curve Using Base R
```{r}
# get a dataset from R
# Orange dataset has information about the growth of orange trees
orange <- Orange
head(orange)
```

```{r}
# create a density plot
plot(density(orange$circumference),
     main = "CIRCUMFERENCE OF ORANGE TREES",
     xlab = "CIRCUMFERENCE",
     ylab = "DISTRIBUTION")

polygon(density(orange$circumference), col=7, border=2)
```

### Basic Density Curve Using GGPlot2
```{r}
# create the density plot

orange %>%
  ggplot( aes(x = circumference)) +
  geom_density(fill= 7, color= 2)

```


## Bar Plot

## Line Plot ("Time Series Plot")

## Stacked Area Plot

## Boxplot

## Violin Plot

## Strip Plot

## Normal Probability (QQ) Plot

## Mosaic Plot

## Scatterplots

## Bubble Plot

## Diverging Bar Chart

## Diverging Lollipop Chart

## Choropleth

### Creating a Choropleth 

I had some difficulty with this plot, so here is a tutorial from https://www.r-graph-gallery.com/327-chloropleth-map-from-geojson-with-ggplot2.html showing how to create a really good example of a choropleth.

LOAD A GEOJSON FILE
```{r}

# Geospatial data available at the geojson format
library(geojsonio)
spdf <- geojson_read("https://raw.githubusercontent.com/gregoiredavid/france-geojson/master/communes.geojson",  what = "sp")

# Since it is a bit too much data, I select only a subset of it:
spdf <- spdf[ substr(spdf@data$code,1,2)  %in% c("06", "83", "13", "30", "34", "11", "66") , ]

```

CREATE A BASIC BACKGROUND MAP
```{r}
#plot(spdf)

# I need to fortify the data AND keep trace of the commune code! (Takes ~2 minutes)
library(broom)
spdf_fortified <- tidy(spdf, region = "code")

# Now I can plot this shape easily as described before:
library(ggplot2)
ggplot() +
  geom_polygon(data = spdf_fortified, aes( x = long, y = lat, group = group), fill="white", color="grey") +
  theme_void() +
  coord_map()
```

READ IN THE NUMERIC DATA
```{r}
# read data
data <- read.table("https://raw.githubusercontent.com/holtzy/R-graph-gallery/master/DATA/data_on_french_states.csv", header=T, sep=";")
head(data)

# Distribution of the number of restaurant?
library(dplyr)
data %>%
  ggplot( aes(x=nb_equip)) +
    geom_histogram(bins=20, fill='skyblue', color='#69b3a2') + scale_x_log10()
```

MERGE THE GEOSPATIAL AND NUMERIC DATA
```{r}
# Make the merge
spdf_fortified = spdf_fortified %>%
  left_join(. , data, by=c("id"="depcom"))

# Note that if the number of restaurant is NA, it is in fact 0
spdf_fortified$nb_equip[ is.na(spdf_fortified$nb_equip)] = 0.001
```

FILL THE MAP WITH THE NUMERIC DATA
```{r}
ggplot() +
  geom_polygon(data = spdf_fortified, aes(fill = nb_equip, x = long, y = lat, group = group)) +
  theme_void() +
  coord_map()
```

CUSTOMIZE THE MAP 
```{r}
library(viridis)
p <- ggplot() +
  geom_polygon(data = spdf_fortified, aes(fill = nb_equip, x = long, y = lat, group = group) , size=0, alpha=0.9) +
  theme_void() +
  scale_fill_viridis(trans = "log", breaks=c(1,5,10,20,50,100), name="Number of restaurant", guide = guide_legend( keyheight = unit(3, units = "mm"), keywidth=unit(12, units = "mm"), label.position = "bottom", title.position = 'top', nrow=1) ) +
  labs(
    title = "South of France Restaurant concentration",
    subtitle = "Number of restaurant per city district",
    caption = "Data: INSEE | Creation: Yan Holtz | r-graph-gallery.com"
  ) +
  theme(
    text = element_text(color = "#22211d"),
    plot.background = element_rect(fill = "#f5f5f2", color = NA),
    panel.background = element_rect(fill = "#f5f5f2", color = NA),
    legend.background = element_rect(fill = "#f5f5f2", color = NA),

    plot.title = element_text(size= 22, hjust=0.01, color = "#4e4d47", margin = margin(b = -0.1, t = 0.4, l = 2, unit = "cm")),
    plot.subtitle = element_text(size= 17, hjust=0.01, color = "#4e4d47", margin = margin(b = -0.1, t = 0.43, l = 2, unit = "cm")),
    plot.caption = element_text( size=12, color = "#4e4d47", margin = margin(b = 0.3, r=-99, unit = "cm") ),

    legend.position = c(0.7, 0.09)
  ) +
  coord_map()
p
```

TRY IT USING DIFFERENT DATA 
```{r}
library(geojsonio)
spdf2 <- geojson_read("https://raw.githubusercontent.com/leakyMirror/map-of-europe/master/GeoJSON/europe.geojson", what = "sp")

```
```{r}
library(broom)
spdf_fortified2 <- tidy(spdf2)

#plot using R
library(ggplot2)
ggplot() +
  geom_polygon(data = spdf_fortified2, aes( x = long, y = lat, group = group), fill="white", color="gray") +
  theme_void() +
  coord_map()
```

```{r}
# i found population data online and they provided the following code to load the data into R

install.packages("jsonlite", repos="https://cran.rstudio.com/")
library("jsonlite")

json_file <- 'https://datahub.io/opendatafortaxjustice/eucountrydatawb/datapackage.json'
json_data <- fromJSON(paste(readLines(json_file), collapse=""))

# get list of all resources:
print(json_data$resources$name)

# print all tabular data(if exists any)
for(i in 1:length(json_data$resources$datahub$type)){
  if(json_data$resources$datahub$type[i]=='derived/csv'){
    path_to_file = json_data$resources$path[i]
    data2 <- read.csv(url(path_to_file))
    print(data2)
  }
}

```
```{r}
library(dplyr)
data2 %>%
  ggplot( aes(x= GDP.per.cap)) +
    geom_histogram(bins=20, fill='skyblue', color='#69b3a2') + scale_x_log10()

```
```{r}
# Make the merge
spdf_fortified2 = spdf_fortified2 %>%
  left_join(. , data2, by=c("id"="jurisdiction"))
```

```{r}
ggplot() +
  geom_polygon(data = spdf_fortified2, aes(fill = data2$GDP.per.capita, x = long, y = lat )) +
  theme_void() +
  coord_map()
```
```{r}
library(viridis)
p <- ggplot() +
  geom_polygon(data = spdf_fortified2, aes(fill = data2$GDP.per.capita, x = long, y = lat, group = group) , size=0, alpha=0.9) +
  theme_void() +
  scale_fill_viridis(trans = "log", breaks=c(1000, 10000, 100000), name="GDP Per Capita", guide = guide_legend( keyheight = unit(3, units = "mm"), keywidth=unit(12, units = "mm"), label.position = "bottom", title.position = 'top', nrow=1) ) +
  labs(
    title = "GDP Per Capita",
    caption = "Data: INSEE | Creation: Yan Holtz | r-graph-gallery.com"
  ) +
  theme(
    text = element_text(color = "#22211d"),
    plot.background = element_rect(fill = "#f5f5f2", color = NA),
    panel.background = element_rect(fill = "#f5f5f2", color = NA),
    legend.background = element_rect(fill = "#f5f5f2", color = NA),

    plot.title = element_text(size= 22, hjust=0.01, color = "#4e4d47", margin = margin(b = -0.1, t = 0.4, l = 2, unit = "cm")),
    plot.subtitle = element_text(size= 17, hjust=0.01, color = "#4e4d47", margin = margin(b = -0.1, t = 0.43, l = 2, unit = "cm")),
    plot.caption = element_text( size=12, color = "#4e4d47", margin = margin(b = 0.3, r=-99, unit = "cm") ),

    legend.position = c(0.7, 0.09)
  ) +
  coord_map()
p
```

